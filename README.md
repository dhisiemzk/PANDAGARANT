Telegram Бот-Гарант

Telegram бот для безопасных сделок с поддержкой рублей, криптовалют и "звёзд" (внутренняя валюта).

Особенности

- Безопасные сделки с участием гарантов
- Поддержка валют: рубли, криптовалюты, звёзды
- Система пользователей с рейтингом и историей
- Управление кошельками с валидацией
- Система гарантов для контроля сделок
- Рейтинги и оценки участников
- Админ-панель для управления
- Детальная статистика и логирование

Установка

1. Клонирование репозитория
git clone <repository-url>

2. Установка зависимостей
pip install -r requirements.txt

3. Настройка переменных окружения
Создайте файл .env на основе .env.example:
cp .env.example .env

Отредактируйте файл .env:
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
OWNER_ID=123456789

4. Вставьте API ключ Pastebin
Откройте файл handlers/chat_handlers.py и найдите строку 539.
Замените пустую строку на ваш API ключ Pastebin:
'api_dev_key': 'ваш_ключ_api_pastebin'

5. Запуск бота
python main.py

Функциональность

Для пользователей

Создание сделки:
1. Нажмите "Создать сделку"
2. Выберите тип валюты (рубли/крипта/звёзды)
3. Укажите сумму и описание товара
4. Получите код сделки и отправьте покупателю

Присоединение к сделке:
1. Нажмите "Присоединиться к сделке"
2. Введите код, полученный от продавца
3. Дождитесь подключения гаранта

Управление кошельками:
- Добавление BTC, USDT, TON адресов или банковских карт
- Валидация всех типов кошельков
- Удаление и редактирование

Для гарантов

- Получение уведомлений о новых сделках
- Контроль процесса обмена
- Завершение или отмена сделок
- Возможность вести только одну сделку одновременно

Админ-панель

Доступна по команде /admin только владельцу:

Управление пользователями:
- Поиск пользователей по ID
- Блокировка/разблокировка
- Изменение баланса звёзд
- Назначение гарантов

Статистика:
- Общее количество пользователей и сделок
- Объём операций
- Активность системы

Логирование:
- Просмотр всех действий пользователей
- Команда /logs для детального анализа

Рассылка:
- Отправка сообщений всем пользователям

Безопасность

Валидация кошельков
- Банковские карты: строго 16 цифр
- Bitcoin: поддержка Legacy, SegWit и Bech32 форматов
- USDT: Ethereum (0x...) и TRON (T...) адреса
- TON: стандартные и user-friendly форматы

Ограничения
- Один пользователь = одна активная сделка
- Обязательная привязка кошелька для создания сделок
- Автоудаление неактивных сделок через 10 минут
- Гарант может вести только одну сделку

Система рейтингов
- Базовый рейтинг: 5.0
- Оценки от 1 до 5 звёзд
- Пересчёт при наличии минимум 3 оценок
- Невозможность оценить без участия в сделке

Структура базы данных

-- Пользователи
users: user_id, username, first_name, rating, total_deals, completed_deals, is_banned, is_guarantor, balance_stars

-- Кошельки
wallets: id, user_id, wallet_type, wallet_address, is_active

-- Сделки
deals: id, deal_code, seller_id, buyer_id, guarantor_id, currency_type, amount, description, status

-- Оценки
ratings: id, deal_id, from_user_id, to_user_id, rating, comment

-- Логи
logs: id, action, user_id, deal_id, details, timestamp

Жизненный цикл сделки

1. waiting_buyer - Продавец создал сделку, ожидает покупателя
2. waiting_guarantor - Покупатель присоединился, ожидает гаранта
3. in_progress - Гарант принял сделку, идёт обмен
4. completed - Сделка успешно завершена
5. cancelled - Сделка отменена

Обработка ошибок

- Автоматическое логирование всех действий
- Graceful обработка ошибок сети
- Защита от некорректного ввода
- Валидация всех пользовательских данных

Логирование

Все действия записываются в таблицу logs:
- Регистрация пользователей
- Создание/изменение сделок
- Добавление/удаление кошельков
- Действия администратора
- Системные события

Расширение функциональности

Архитектура бота позволяет легко добавлять:
- Новые типы кошельков в utils/validators.py
- Дополнительные валюты в config.py
- Новые обработчики в папке handlers/
- Расширенную статистику в database.py

Поддержка

При возникновении проблем:
1. Проверьте логи в файле bot.log
2. Убедитесь в корректности переменных окружения
3. Проверьте права доступа к базе данных

Лицензия

Этот проект создан для демонстрационных целей. Используйте на свой страх и риск. 
"# PANDAGARANT" 
